name: åŒæ­¥Forkä¸ä¸Šæ¸¸ä»“åº“

on:
 schedule:
   - cron: "0 0 * * *"    # æ¯å¤©å‡Œæ™¨é›¶ç‚¹æ‰§è¡Œ
 workflow_dispatch:

env:
 UPSTREAM_REPO: "jaywcjlove/reference"
 UPSTREAM_BRANCH: "gh-pages"

jobs:
 sync:
   runs-on: ubuntu-latest
   steps:
     - name: æ£€å‡ºForkä»“åº“
       uses: actions/checkout@v4
       with:
         fetch-depth: 0
         token: ${{ secrets.GITHUB_TOKEN }}
         ref: gh-pages

     - name: é…ç½®Gitç”¨æˆ·ä¿¡æ¯
       run: |
         git config user.name 'github-actions[bot]'
         git config user.email 'github-actions[bot]@users.noreply.github.com'

     - name: æ·»åŠ ä¸Šæ¸¸ä»“åº“
       run: |
         if git remote get-url upstream >/dev/null 2>&1; then
           git remote set-url upstream https://github.com/${{ env.UPSTREAM_REPO }}.git
         else
           git remote add upstream https://github.com/${{ env.UPSTREAM_REPO }}.git
         fi
         git fetch upstream ${{ env.UPSTREAM_BRANCH }}

     - name: æ£€æŸ¥æ˜¯å¦éœ€è¦åŒæ­¥
       id: check_sync_needed
       run: |
         git fetch origin gh-pages
         if git diff --quiet origin/gh-pages upstream/${{ env.UPSTREAM_BRANCH }}; then
           echo "needs_sync=false" >> $GITHUB_OUTPUT
           echo "âœ… ä»“åº“å·²æ˜¯æœ€æ–°ï¼Œæ— éœ€åŒæ­¥"
         else
           echo "needs_sync=true" >> $GITHUB_OUTPUT
           echo "ğŸ”„ æ£€æµ‹åˆ°æ›´æ–°ï¼Œå¼€å§‹åŒæ­¥"
         fi

     - name: å¼ºåˆ¶åŒæ­¥ä¸Šæ¸¸ä»“åº“
       if: steps.check_sync_needed.outputs.needs_sync == 'true'
       run: |
         git checkout gh-pages
         git reset --hard upstream/${{ env.UPSTREAM_BRANCH }}
         echo "âœ… å¼ºåˆ¶åŒæ­¥å®Œæˆ"

     - name: æ¨é€æ›´æ–°åˆ°Forkä»“åº“
       if: steps.check_sync_needed.outputs.needs_sync == 'true'
       run: |
         git push --force-with-lease origin gh-pages
         echo "ğŸš€ æ¨é€å®Œæˆ"
